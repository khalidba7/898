
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>مزاد القادحات لمزاد الخيل</title>
<style>
    body {margin:0; font-family: Arial, sans-serif; background:#f5f5f5;}
    .page {display:none; padding:20px; text-align:center;}
    .active {display:block;}
    h1, h2, h3 {color:#5a381e;}
    button {background:#b8860b; color:#fff; padding:8px 15px; border:none; border-radius:8px; font-size:14px; cursor:pointer; margin:5px;}
    button:hover {background:#8b6914;}
    input, textarea {width:90%; padding:8px; margin:8px 0; border-radius:6px; border:1px solid #ccc; font-size:14px;}
    .back-btn {background:#555;}
    .horse-card {background:#fff; margin:10px auto; padding:10px; border-radius:8px; width:90%; box-shadow:0 0 5px rgba(0,0,0,0.1); text-align:right;}
    .timer {color:red; font-weight:bold;}
    .horse-thumb {max-width:100px; max-height:100px; border-radius:6px; display:block; margin-bottom:10px;}
    .bid-info {background:#f0f0f0; padding:8px; border-radius:6px; margin-top:8px;}
    .popup {display:none; position:fixed; z-index:1000; padding-top:50px; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.8);}
    .popup-content {background:#fff; margin:auto; padding:20px; border-radius:8px; width:90%; max-width:500px; position:relative;}
    .popup-content img {max-width:100%; margin-bottom:10px; border-radius:6px;}
    .close-btn {position:absolute; top:10px; left:10px; background:#b8860b; color:#fff; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;}
    table {width:100%; border-collapse:collapse; margin-top:15px;}
    th, td {border:1px solid #ccc; padding:8px; font-size:14px;}
</style>
</head>
<body>

<div id="welcomePage" class="page active">
    <h1>مرحبا بكم في مزاد القادحات لمزاد الخيل</h1>
    <button onclick="showPage('registerPage')">ابدأ</button>
</div>

<div id="registerPage" class="page">
    <h2>تسجيل المشترك</h2>
    <input type="text" id="userName" placeholder="الاسم الثلاثي والقبيلة">
    <input type="text" id="userPhone" placeholder="رقم الجوال">
    <button onclick="saveUser()">متابعة</button>
    <button class="back-btn" onclick="showPage('welcomePage')">رجوع</button>
</div>

<div id="menuAfterRegister" class="page">
    <h2>القائمة</h2>
    <button onclick="showPage('auctionPage')">دخول المزاد</button>
    <button onclick="showPage('addHorsePage')">إضافة خيل للمزاد</button>
    <button onclick="adminLogin()">دخول المطور</button>
</div>

<div id="addHorsePage" class="page">
    <h2>إضافة خيل</h2>
    <input type="text" id="horseName" placeholder="اسم الخيل">
    <input type="text" id="horseAge" placeholder="العمر">
    <input type="text" id="horseHealth" placeholder="الحالة الصحية">
    <textarea id="horseDetails" placeholder="إنجازات الخيل وتفاصيله"></textarea>
    <label>اختر حتى 5 صور للخيل:</label>
    <input type="file" id="horseImages" multiple accept="image/*">
    <label>صورة جواز الخيل (اختياري):</label>
    <input type="file" id="horsePassport" accept="image/*">
    <button onclick="saveHorse()">حفظ</button>
    <button class="back-btn" onclick="showPage('menuAfterRegister')">رجوع</button>
</div>

<div id="auctionPage" class="page">
    <h2>المزاد</h2>
    <div id="auctionList"></div>
    <button class="back-btn" onclick="showPage('menuAfterRegister')">رجوع</button>
</div>

<div id="adminPage" class="page">
    <h2>لوحة تحكم المطور</h2>
    <h3>المشتركين</h3>
    <table id="usersTable">
        <tr><th>الاسم</th><th>رقم الجوال</th></tr>
    </table>
    <h3>الإعلانات</h3>
    <div id="adsList"></div>
    <button class="back-btn" onclick="showPage('menuAfterRegister')">رجوع</button>
</div>

<div id="popup" class="popup" onclick="closePopup(event)">
    <div class="popup-content" id="popupContent">
        <button class="close-btn" onclick="document.getElementById('popup').style.display='none'">إغلاق</button>
    </div>
</div>

<script>
let horses = JSON.parse(localStorage.getItem('horses')) || [];
let users = JSON.parse(localStorage.getItem('users')) || [];

function showPage(id){
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    if(id==='auctionPage') renderAuction();
    if(id==='adminPage') renderAdmin();
}

function saveUser(){
    let name = document.getElementById('userName').value;
    let phone = document.getElementById('userPhone').value;
    localStorage.setItem('userName', name);
    localStorage.setItem('userPhone', phone);
    users.push({name, phone});
    localStorage.setItem('users', JSON.stringify(users));
    showPage('menuAfterRegister');
}

function saveHorse(){
    const images = Array.from(document.getElementById('horseImages').files).slice(0,5).map(f=>URL.createObjectURL(f));
    const horse = {
        name: document.getElementById('horseName').value,
        age: document.getElementById('horseAge').value,
        health: document.getElementById('horseHealth').value,
        details: document.getElementById('horseDetails').value,
        owner: localStorage.getItem('userName'),
        phone: localStorage.getItem('userPhone'),
        startTime: Date.now(),
        highestBidder: null,
        highestBid: null,
        images: images,
        passport: document.getElementById('horsePassport').files[0] ? URL.createObjectURL(document.getElementById('horsePassport').files[0]) : null
    };
    horses.push(horse);
    localStorage.setItem('horses', JSON.stringify(horses));
    alert('تم حفظ الخيل بنجاح');
    showPage('menuAfterRegister');
}

function renderAuction(){
    const container=document.getElementById('auctionList');
    container.innerHTML='';
    horses.forEach((h,index)=>{
        const thumb = h.images && h.images.length > 0 ? `<img src="${h.images[0]}" class="horse-thumb">` : '';
        container.innerHTML += `
            <div class="horse-card">
                ${thumb}
                <h3>${h.name}</h3>
                <p>الحالة الصحية: ${h.health}</p>
                <p>الإنجازات: ${h.details || 'لا يوجد'}</p>
                <div class="bid-info">
                    <p>أعلى مزايد: ${h.highestBidder ? h.highestBidder + ' - ' + h.phone : 'لا يوجد'}</p>
                    <p>المبلغ الحالي: ${h.highestBid ? h.highestBid + ' ريال' : '-'}</p>
                </div>
                <input type="number" id="bidAmount-${index}" placeholder="أدخل مبلغ المزايدة">
                <button onclick="placeBid(${index})">مزايدة</button>
                <button onclick="openPopup(${index})">عرض الصور والجواز</button>
            </div>`;
    });
}

function placeBid(index){
    const amount=parseFloat(document.getElementById(`bidAmount-${index}`).value);
    if(!amount){
        alert('أدخل مبلغ المزايدة');
        return;
    }
    const name = localStorage.getItem('userName');
    const phone = localStorage.getItem('userPhone');
    horses[index].highestBidder=name;
    horses[index].highestBid=amount;
    horses[index].phone=phone;
    localStorage.setItem('horses', JSON.stringify(horses));
    renderAuction();
}

function adminLogin(){
    let pass = prompt('أدخل كلمة المرور');
    if(pass === "Khalid@9966"){
        showPage('adminPage');
    } else {
        alert('كلمة المرور غير صحيحة');
    }
}

function renderAdmin(){
    let usersTable = document.getElementById('usersTable');
    usersTable.innerHTML = '<tr><th>الاسم</th><th>رقم الجوال</th></tr>';
    users.forEach(u => {
        usersTable.innerHTML += `<tr><td>${u.name}</td><td>${u.phone}</td></tr>`;
    });
    let adsList = document.getElementById('adsList');
    adsList.innerHTML = '';
    horses.forEach((h,index)=>{
        adsList.innerHTML += `
            <div class="horse-card">
                <h3>${h.name}</h3>
                <p>${h.health}</p>
                <button onclick="deleteAd(${index})">حذف</button>
            </div>`;
    });
}

function deleteAd(index){
    if(confirm('هل أنت متأكد من حذف هذا الإعلان؟')){
        horses.splice(index,1);
        localStorage.setItem('horses', JSON.stringify(horses));
        renderAdmin();
    }
}

function openPopup(index){
    const horse=horses[index];
    const popupContent=document.getElementById('popupContent');
    popupContent.innerHTML='<button class="close-btn" onclick="document.getElementById(\'popup\').style.display=\'none\'">إغلاق</button>';
    if(horse.images && horse.images.length>0){
        horse.images.forEach(img=>{
            const imageEl=document.createElement('img');
            imageEl.src=img;
            popupContent.appendChild(imageEl);
        });
    }
    if(horse.passport){
        const passportImg=document.createElement('img');
        passportImg.src=horse.passport;
        popupContent.appendChild(passportImg);
    }
    document.getElementById('popup').style.display='block';
}

function closePopup(event){
    if(event.target.id==='popup'){
        document.getElementById('popup').style.display='none';
    }
}
</script>

</body>
</html>
